---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# hercacstables

This package provides an R interface to the United States Census Bureau's data
API.
The primary focus, as per its name, is pulling information from the
[detailed tables of the American Community Survey](https://www.census.gov/programs-surveys/acs/data/data-tables.html).

<!-- badges: start -->
<!-- badges: end -->

## Installation

You can install the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("higherX4Racine/hercacstables")
```

## Examples

The main way that one uses `hercacstables` to interact with the Census API is
the `hercacstables::fetch_data()` function.

### Population and number of households

```{r}
#| label: fetch-pops-and-households
#| cache: true

POPS_AND_HOUSEHOLDS <- hercacstables::fetch_data(
    # the API works one year at a time
    year = hercacstables::most_recent_vintage("acs", "acs1"),
    
    # the API can only query one data source at a time
    survey_type = "acs",           # the American Community Survey
    table_or_survey_code = "acs1", # the 1-year dataset of the ACS
    
    # the API fetches values for one or more instances of a specific geography
    for_geo = "state",             # fetch values for entire states
    for_items = c(
        "11",                      # the District of Columbia
        "72"                       # Puerto Rico
    ),
    
    # the codes for the specific data that we are fetching
    variables = c(
        "NAME",                    # the geographic area's name
        "B01001_001E",             # the total number of people
        "B11002_002E",             # people in family households
        "B11002_012E"              # people in nonfamily households
    )
)
```

```{r}
#| label: show-pops-and-households
#| echo: false
POPS_AND_HOUSEHOLDS |>
    dplyr::mutate(
        Value = scales::label_comma(accuracy = 1)(.data$Value)
    ) |>
    knitr::kable(
        align = "lrlrrr"
    )
```

### Decennial populations by race and ethnicity

```{r}
#| label: fetch-decennial-pops-by-race
#| cache: true
POPS_BY_RACE <-
    hercacstables::fetch_decennial_pops_by_race(
        for_geo = "state", # one cannot fetch the whole nation from 2000 or 2010
        for_items = "*"    # so we pull the data for every state
    ) |>
    dplyr::count( # then compute the nationwide populations for each vintage
        .data$`Race/Ethnicity`,
        .data$Vintage,
        wt = .data$Population,
        name = "Population"
    ) |>
    tidyr::pivot_wider( # and reshape the table for display
        names_from = "Vintage",
        values_from = "Population"
    )
```

```{r}
#| label: show-decennial-pops-by-race
#| echo: false
POPS_BY_RACE |>
    dplyr::mutate(
        dplyr::across(tidyselect::ends_with("0"),
                      \(.)scales::label_comma(accuracy = 1)(.))
    ) |>
    knitr::kable(
        align = "lrrr"
    )
```


## Going farther

Many questions that work with Census data follow a common pattern:

> How did [measurement] differ among [demographic groups] and across
[geographies] during [span of time]?

To use this pattern, an investigator must determine some concrete definitions
for each of the bracketed concepts.
The `hercacstables` package provides tools for each of these four tasks.
This site provides detailed articles for each task because each one can be
[complex](https://www.census.gov/data/developers/guidance/api-user-guide.Core_Concepts.html).

* [Use one or more Census measurements](articles/determine_measurement.html)
* [Describe who or what has been measured](articles/determine_demographies.html)
* [Specify where the measurements were made](articles/determine_geographies.html)
* [Choose the year(s) that are relevant](articles/determine_timeframes.html)
