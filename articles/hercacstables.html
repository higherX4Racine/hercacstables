<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>hercacstables • hercacstables</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="hercacstables">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hercacstables</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/hercacstables.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/average_tract_poverty_ratio.html">Average Poverty Ratios by Tract in Racine County, WI</a></li>
    <li><a class="dropdown-item" href="../articles/children_in_poverty.html">Children in Poverty</a></li>
    <li><a class="dropdown-item" href="../articles/race_ethnicity_categories.html">Race/Ethnicity Categories in ACS Tables</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>hercacstables</h1>
            
      

      <div class="d-none name"><code>hercacstables.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="welcome">Welcome<a class="anchor" aria-label="anchor" href="#welcome"></a>
</h2>
<p>If this is your first time using <code>hercacstables</code> then you
probably want to <a href="#set-up-your-api-key">register with the
Census</a>. Otherwise, welcome back!</p>
<p>This package helps R users to access data from the United States
Census Bureau, especially its American Community Survey.</p>
<p>The database has an enormous amount of information, stored in a
versatile but cumbersome format. Data are stored in hundreds of
different tables, called “groups,” that give breakdowns of information.
For example, group <a href="https://api.census.gov/data/2022/acs/acs5/groups/B21005.html" class="external-link"><code>B21005</code></a>
reports counts of people according to their employment status, military
service, and age. Each row in a group reports a value for a specific
slice of the topic. For example, row 5 in group <code>B21005</code>
gives the number of employed veterans between the ages of 18 and 34. The
Census combines the group code and row into a variable,
<code>B21005_005E</code>. This packing of information gives the Census a
very flexible way to report all of their data. However, it is
challenging for the user because you have to somehow know the variables
that report the data that you are interested in.</p>
<p>In light of that, <code>hercacstables</code> is designed to help
people make repeated, efficient use of the Census’s API. There are
<em>metadata</em> tables that explicitly connect real-world concepts to
Census variables. You can then use database-style joins to connect the
concepts to the values that you pull from the API.</p>
</div>
<div class="section level2">
<h2 id="worked-example">Worked example<a class="anchor" aria-label="anchor" href="#worked-example"></a>
</h2>
<p>If you want to use the Census API then you probably have a real-world
question that you think the data will help you to answer. For example,
you might ask</p>
<blockquote>
<p><strong>How have populations changed in Ohio’s four largest school
districts?</strong></p>
</blockquote>
<p>To answer this with <code>hercacstables</code>, you should break it
down into four component questions.</p>
<div class="section level4">
<h4 id="who">
<strong>Who?</strong><a class="anchor" aria-label="anchor" href="#who"></a>
</h4>
<p>What population or populations are you trying to understand? This
will help us identify the <a href="https://api.census.gov/data/2022/acs/acs5/groups.html" class="external-link">groups</a>
and <a href="https://api.census.gov/data/2022/acs/acs5/variables.html" class="external-link">variables</a>
that we will specifically ask for.</p>
<p>All of those groups and values can be accessed offline with
<code><a href="../reference/ACS_GROUP_METADATA.html">hercacstables::ACS_GROUP_METADATA</a></code> and
<code><a href="../reference/ACS_VARIABLE_METADATA.html">hercacstables::ACS_VARIABLE_METADATA</a></code>.</p>
<p>We want to know about populations in school districts. It makes sense
then to only look at school-aged children, say 5-18. Our requests should
only ask for data about kids in that age range. We can do this with the
built-in table <code><a href="../reference/AGE_AND_SEX_METADATA.html">hercacstables::AGE_AND_SEX_METADATA</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">school_children_metadata</span> <span class="op">&lt;-</span> <span class="fu">hercacstables</span><span class="fu">::</span><span class="va"><a href="../reference/AGE_AND_SEX_METADATA.html">AGE_AND_SEX_METADATA</a></span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">.data</span><span class="op">$</span><span class="va">`Lower Age`</span> <span class="op">&gt;=</span> <span class="fl">5</span>,</span>
<span>        <span class="va">.data</span><span class="op">$</span><span class="va">`Upper Age`</span> <span class="op">&lt;=</span> <span class="fl">18</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">school_children_metadata</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">group</th>
<th align="right">index</th>
<th align="left">variable</th>
<th align="left">Sex</th>
<th align="right">Lower Age</th>
<th align="right">Upper Age</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">B01001</td>
<td align="right">4</td>
<td align="left">B01001_004E</td>
<td align="left">Male</td>
<td align="right">5</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">B01001</td>
<td align="right">5</td>
<td align="left">B01001_005E</td>
<td align="left">Male</td>
<td align="right">10</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">B01001</td>
<td align="right">6</td>
<td align="left">B01001_006E</td>
<td align="left">Male</td>
<td align="right">15</td>
<td align="right">17</td>
</tr>
<tr class="even">
<td align="left">B01001</td>
<td align="right">28</td>
<td align="left">B01001_028E</td>
<td align="left">Female</td>
<td align="right">5</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">B01001</td>
<td align="right">29</td>
<td align="left">B01001_029E</td>
<td align="left">Female</td>
<td align="right">10</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">B01001</td>
<td align="right">30</td>
<td align="left">B01001_030E</td>
<td align="left">Female</td>
<td align="right">15</td>
<td align="right">17</td>
</tr>
</tbody>
</table>
<p>From this table we can see that we will need to include six variables
in our API query.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SCHOOL_CHILDREN_VARIABLES</span> <span class="op">&lt;-</span> <span class="va">school_children_metadata</span><span class="op">$</span><span class="va">variable</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">SCHOOL_CHILDREN_VARIABLES</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "B01001_004E" "B01001_005E" "B01001_006E" "B01001_028E" "B01001_029E"</span></span>
<span><span class="co">#&gt; [6] "B01001_030E"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="where">
<strong>Where?</strong><a class="anchor" aria-label="anchor" href="#where"></a>
</h4>
<p>What kind of place, and specific location, should the data describe?
The Census API can provide information at many <a href="https://www.census.gov/programs-surveys/geography/guidance/geo-identifiers.html" class="external-link">levels
of geographical detail</a>. Some questions might pertain to entire
states. Others might involve comparisons among all of the tracts in a
metropolitan area. You can find details about the different geographic
levels in <code><a href="../reference/ACS_GEOGRAPHY_METADATA.html">hercacstables::ACS_GEOGRAPHY_METADATA</a></code>. If you
know the real-world name of a place, but not the numeric code that the
Census uses for it, then you can look it up <a href="https://www.census.gov/library/reference/code-lists/ansi.html" class="external-link">here</a>.</p>
<p>For the question that we’re dealing with, we want to look at the
geographic area served by a school district. There are actually three
different kinds of school district geographic levels.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">school_district_geographies</span> <span class="op">&lt;-</span> <span class="fu">hercacstables</span><span class="fu">::</span><span class="va"><a href="../reference/ACS_GEOGRAPHY_METADATA.html">ACS_GEOGRAPHY_METADATA</a></span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">`Geographic Level`</span>, <span class="st">"school"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">school_district_geographies</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="32%">
<col width="25%">
<col width="17%">
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="left">Geographic Level</th>
<th align="left">Containing Geographies</th>
<th align="left">Wildcard Option</th>
<th align="left">ACS1</th>
<th align="left">ACS5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">school district (elementary)</td>
<td align="left">{state}</td>
<td align="left">{state}</td>
<td align="left">2023-01-01</td>
<td align="left">2022-01-01</td>
</tr>
<tr class="even">
<td align="left">school district (secondary)</td>
<td align="left">{state}</td>
<td align="left">{state}</td>
<td align="left">2023-01-01</td>
<td align="left">2022-01-01</td>
</tr>
<tr class="odd">
<td align="left">school district (unified)</td>
<td align="left">{state}</td>
<td align="left">{state}</td>
<td align="left">2023-01-01</td>
<td align="left">2022-01-01</td>
</tr>
</tbody>
</table>
<p>It looks like the specific geographic level that we should ask about
is “school districts (unified)”.</p>
<p>The “Containing Geographies” column lets us know that we also have to
tell the API which state we are interested in. The “Wildcard Option”
column tells us that we can use “*” to say “all of the states.”</p>
<p>We just want Ohio, so we must supply its FIPS code. If you don’t know
it off the top of your head, you can use a <a href="https://www.census.gov/library/reference/code-lists/ansi.html" class="external-link">page</a>
on the Census’s website to search for the FIPS code of a specific
geography.</p>
<p>Ohio’s FIPS code is 39.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">UNIFIED_SCHOOL_DISTRICT</span> <span class="op">&lt;-</span> <span class="va">school_district_geographies</span><span class="op">$</span><span class="va">`Geographic Level`</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">UNIFIED_SCHOOL_DISTRICT</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "school district (unified)"</span></span>
<span><span class="va">STATE_FIPS</span> <span class="op">&lt;-</span> <span class="fl">39</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="when">
<strong>When?</strong><a class="anchor" aria-label="anchor" href="#when"></a>
</h4>
<p>A request to the Census API must include year its path. That means
that it takes multiple API calls to pull data for multiple years. Each
of these calls will be identical to the others, <em>except for</em> the
year in the path. This repetitiveness might just be the single biggest
motivator for developing <code>hercacstables</code>. It’s very easy in R
to iterate over an array of years, making one function call for each
year, and then bundling all of the results into one tidy data frame.</p>
<p>The other aspect of the “when” question is whether or not to use
1-year or 5-year estimates. The ACS reports both. Five-year estimates
include data from the preceding four years. This increases sample sizes
enough to provide information for smaller geographic levels, like tracts
and block groups. One-year estimates are more responsive to rapid
changes (like unemployment during the COVID-19 pandemic, for example),
but are only available for larger geographic levels.</p>
<p>Unified school districts are large enough for the 1-year ACS to
include them. For our example, we will use every year of data available.
That is 2005 to 2022, except for 2020, which does not have 1-year ACS
data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">YEARS_FOR_ACS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2005</span><span class="op">:</span><span class="fl">2019</span>, <span class="fl">2021</span><span class="op">:</span><span class="fl">2023</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="what-describe-the-steps-to-answer-our-question">
<strong>What?</strong> Describe the steps to answer our
question<a class="anchor" aria-label="anchor" href="#what-describe-the-steps-to-answer-our-question"></a>
</h4>
<p>Thus far, we have identified what we need to deal with the
“populations” (who), “school districts” and “in Ohio” (where), and
“changed” (when) aspects of our question. The final aspect is the “four
largest” parts. It will take three steps to find the four largest school
districts in Ohio.</p>
<p>The first step is to use the [hercacstables::fetch_data()] function
to pull data from the Census API. We need the number of children that
live in each school district in Ohio in the most recent year
available.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fetch_district_children</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.state_fips</span>, <span class="va">.year</span>, <span class="va">.district_geoids</span> <span class="op">=</span> <span class="st">"*"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">hercacstables</span><span class="fu">::</span><span class="fu"><a href="../reference/fetch_data.html">fetch_data</a></span><span class="op">(</span></span>
<span>        variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NAME"</span>, <span class="va">SCHOOL_CHILDREN_VARIABLES</span><span class="op">)</span>, <span class="co"># district names, too</span></span>
<span>        year <span class="op">=</span> <span class="va">.year</span>,                                     <span class="co"># most recent year</span></span>
<span>        survey_type <span class="op">=</span> <span class="st">"acs"</span>,                              <span class="co"># American Community Survey</span></span>
<span>        table_or_survey_code <span class="op">=</span> <span class="st">"acs1"</span>,                    <span class="co"># One-year estimates</span></span>
<span>        for_geo <span class="op">=</span> <span class="va">UNIFIED_SCHOOL_DISTRICT</span>,                <span class="co"># "school district (unified)"</span></span>
<span>        for_items <span class="op">=</span> <span class="va">.district_geoids</span>,                     <span class="co"># every school district</span></span>
<span>        state <span class="op">=</span> <span class="va">STATE_FIPS</span>                                <span class="co"># our state's two-digit code</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">latest_school_districts_raw</span> <span class="op">&lt;-</span> <span class="fu">fetch_district_children</span><span class="op">(</span><span class="va">STATE_FIPS</span>, <span class="fl">2023</span><span class="op">)</span></span>
<span></span>
<span><span class="va">latest_school_districts_raw</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="47%">
<col width="5%">
<col width="24%">
<col width="6%">
<col width="5%">
<col width="5%">
<col width="4%">
</colgroup>
<thead><tr class="header">
<th align="left">NAME</th>
<th align="left">state</th>
<th align="left">school district (unified)</th>
<th align="left">Group</th>
<th align="right">Index</th>
<th align="right">Value</th>
<th align="right">Year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Toledo City School District, Ohio</td>
<td align="left">39</td>
<td align="left">04490</td>
<td align="left">B01001</td>
<td align="right">6</td>
<td align="right">3872</td>
<td align="right">2023</td>
</tr>
<tr class="even">
<td align="left">Columbus City School District, Ohio</td>
<td align="left">39</td>
<td align="left">04380</td>
<td align="left">B01001</td>
<td align="right">29</td>
<td align="right">14856</td>
<td align="right">2023</td>
</tr>
<tr class="odd">
<td align="left">West Clermont Local School District, Ohio</td>
<td align="left">39</td>
<td align="left">04635</td>
<td align="left">B01001</td>
<td align="right">28</td>
<td align="right">2916</td>
<td align="right">2023</td>
</tr>
<tr class="even">
<td align="left">Fairfield City School District, Ohio</td>
<td align="left">39</td>
<td align="left">04610</td>
<td align="left">B01001</td>
<td align="right">6</td>
<td align="right">1314</td>
<td align="right">2023</td>
</tr>
<tr class="odd">
<td align="left">Toledo City School District, Ohio</td>
<td align="left">39</td>
<td align="left">04490</td>
<td align="left">B01001</td>
<td align="right">29</td>
<td align="right">6601</td>
<td align="right">2023</td>
</tr>
<tr class="even">
<td align="left">Parma City School District, Ohio</td>
<td align="left">39</td>
<td align="left">04463</td>
<td align="left">B01001</td>
<td align="right">4</td>
<td align="right">2072</td>
<td align="right">2023</td>
</tr>
<tr class="odd">
<td align="left">Lakota Local School District (Butler County), Ohio</td>
<td align="left">39</td>
<td align="left">04611</td>
<td align="left">B01001</td>
<td align="right">5</td>
<td align="right">3350</td>
<td align="right">2023</td>
</tr>
<tr class="even">
<td align="left">West Clermont Local School District, Ohio</td>
<td align="left">39</td>
<td align="left">04635</td>
<td align="left">B01001</td>
<td align="right">4</td>
<td align="right">2016</td>
<td align="right">2023</td>
</tr>
</tbody>
</table>
<p>The next step is to sum up the populations for each district and then
sort them from biggest to smallest.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wrangle_latest_kids</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.raw_children</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">.raw_children</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span></span>
<span>            <span class="va">.data</span><span class="op">$</span><span class="va">NAME</span>,</span>
<span>            <span class="va">.data</span><span class="op">[[</span><span class="va">UNIFIED_SCHOOL_DISTRICT</span><span class="op">]</span><span class="op">]</span>,</span>
<span>            name <span class="op">=</span> <span class="st">"Children"</span>,</span>
<span>            wt <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">Value</span></span>
<span>        <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">Children</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">latest_school_districts</span> <span class="op">&lt;-</span> <span class="fu">wrangle_latest_kids</span><span class="op">(</span><span class="va">latest_school_districts_raw</span><span class="op">)</span></span>
<span></span>
<span><span class="va">latest_school_districts</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Children <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_comma</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">Children</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>align <span class="op">=</span> <span class="st">"lrr"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="54%">
<col width="33%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">NAME</th>
<th align="right">school district (unified)</th>
<th align="right">Children</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Columbus City School District, Ohio</td>
<td align="right">04380</td>
<td align="right">79,141</td>
</tr>
<tr class="even">
<td align="left">Cleveland Municipal School District, Ohio</td>
<td align="right">04378</td>
<td align="right">53,773</td>
</tr>
<tr class="odd">
<td align="left">Cincinnati City School District, Ohio</td>
<td align="right">04375</td>
<td align="right">48,798</td>
</tr>
<tr class="even">
<td align="left">Toledo City School District, Ohio</td>
<td align="right">04490</td>
<td align="right">31,622</td>
</tr>
<tr class="odd">
<td align="left">Akron City School District, Ohio</td>
<td align="right">04348</td>
<td align="right">31,297</td>
</tr>
<tr class="even">
<td align="left">South-Western City School District, Ohio</td>
<td align="right">04480</td>
<td align="right">24,636</td>
</tr>
<tr class="odd">
<td align="left">Olentangy Local School District, Ohio</td>
<td align="right">04676</td>
<td align="right">22,083</td>
</tr>
<tr class="even">
<td align="left">Dayton City School District, Ohio</td>
<td align="right">04384</td>
<td align="right">21,972</td>
</tr>
</tbody>
</table>
<p>The last step is to pull the GEOIDs for each of the four biggest
districts.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">top_district_geoids</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.districts</span>, <span class="va">n</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">.districts</span><span class="op">[[</span><span class="va">UNIFIED_SCHOOL_DISTRICT</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">districts_for_query</span> <span class="op">&lt;-</span> <span class="fu">top_district_geoids</span><span class="op">(</span><span class="va">latest_school_districts</span>, <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">districts_for_query</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "04380" "04378" "04375" "04490"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pulling-it-all-together">Pulling it all together<a class="anchor" aria-label="anchor" href="#pulling-it-all-together"></a>
</h3>
<p>Now we have all of the components that we need to pull the population
histories for the four biggest school districts in Ohio.</p>
<p>First, we fetch the data. Notice that we can reuse the fetching
function that we defined above!</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fetch_district_histories</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.state_fips</span>, <span class="va">.district_geoids</span> <span class="op">=</span> <span class="st">"*"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">YEARS_FOR_ACS</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>            \<span class="op">(</span><span class="va">.year</span><span class="op">)</span> <span class="fu">fetch_district_children</span><span class="op">(</span><span class="va">.state_fips</span>,</span>
<span>                                             <span class="va">.year</span>, </span>
<span>                                             <span class="va">.district_geoids</span><span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span> </span>
<span></span>
<span><span class="va">big_district_histories_raw</span> <span class="op">&lt;-</span> <span class="fu">fetch_district_histories</span><span class="op">(</span><span class="va">STATE_FIPS</span>,</span>
<span>                                                       <span class="va">districts_for_query</span><span class="op">)</span></span></code></pre></div>
<p>Next, we sum up the number of children and create human-readable
names for each district.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wrangle_histories</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.raw_district_histories</span>, <span class="va">.latest_districts</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">.raw_district_histories</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span></span>
<span>        <span class="va">.data</span><span class="op">[[</span><span class="va">UNIFIED_SCHOOL_DISTRICT</span><span class="op">]</span><span class="op">]</span>,</span>
<span>        <span class="va">.data</span><span class="op">$</span><span class="va">Year</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"Children"</span>,</span>
<span>        wt <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">Value</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>            <span class="va">.latest_districts</span>,</span>
<span>            <span class="fu">tidyselect</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NAME"</span>, <span class="va">UNIFIED_SCHOOL_DISTRICT</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="op">)</span>,</span>
<span>        by <span class="op">=</span> <span class="va">UNIFIED_SCHOOL_DISTRICT</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        District <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">NAME</span>,</span>
<span>                                        <span class="st">"^\\S*"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>        <span class="st">"District"</span>,</span>
<span>        <span class="st">"Year"</span>,</span>
<span>        <span class="st">"Children"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">big_district_histories</span> <span class="op">&lt;-</span> <span class="fu">wrangle_histories</span><span class="op">(</span><span class="va">big_district_histories_raw</span>,</span>
<span>                                            <span class="va">latest_school_districts</span><span class="op">)</span> </span></code></pre></div>
<p>Finally, we can plot the results.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_district_histories</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.district_histories</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">.district_histories</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>            <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>                x <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">Year</span>,</span>
<span>                y <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">Children</span>,</span>
<span>                color <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">District</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>            linewidth <span class="op">=</span> <span class="fl">2</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>            size <span class="op">=</span> <span class="fl">5</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span></span>
<span>            name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>            labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_number</a></span><span class="op">(</span>big.mark <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>            breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_width.html" class="external-link">breaks_width</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>            minor_breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_width.html" class="external-link">breaks_width</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>            name <span class="op">=</span> <span class="st">"School-aged children in school district's area"</span>,</span>
<span>            labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_comma</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                         scale <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>                                         suffix <span class="op">=</span> <span class="st">"K"</span><span class="op">)</span>,</span>
<span>            limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span></span>
<span>            guide <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                          position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">plot_district_histories</span><span class="op">(</span><span class="va">big_district_histories</span><span class="op">)</span></span></code></pre></div>
<p><img src="hercacstables_files/figure-html/plot-big-district-histories-1.png" width="504"></p>
<p>It looks like maybe a lot of people are moving from Cleveland to
Columbus, and taking their kids with them.</p>
</div>
<div class="section level3">
<h3 id="everything-is-reusable">Everything is reusable<a class="anchor" aria-label="anchor" href="#everything-is-reusable"></a>
</h3>
<p>Now that you’ve seen the example with Ohio, you may be thinking “that
question is not relevant to me.” However! You could rerun all of the
code, changing just the <code>STATE_FIPS</code> to your state’s FIPS
code, and get <em>the same analysis</em> for <strong>a different
state</strong>.</p>
<p>Let’s look at changes in population for the five largest school
districts in Delaware.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">STATE_FIPS</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="va">latest_de_districts</span> <span class="op">&lt;-</span> <span class="va">STATE_FIPS</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">fetch_district_children</span><span class="op">(</span><span class="fl">2023</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">wrangle_latest_kids</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">de_district_geoids</span> <span class="op">&lt;-</span> <span class="va">latest_de_districts</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">top_district_geoids</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">big_de_district_histories</span> <span class="op">&lt;-</span> <span class="va">STATE_FIPS</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">fetch_district_histories</span><span class="op">(</span><span class="va">de_district_geoids</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">wrangle_histories</span><span class="op">(</span><span class="va">latest_de_districts</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_district_histories</span><span class="op">(</span><span class="va">big_de_district_histories</span><span class="op">)</span></span></code></pre></div>
<p><img src="hercacstables_files/figure-html/this-time-for-delaware-1.png" width="504"></p>
<p>You could do the same thing with any other state. That’s the goal of
this project: help define workflows for making reports from Census data
so that they can be easily rerun for comparable places and times.</p>
</div>
</div>
<div class="section level2">
<h2 id="set-up-your-api-key">Set up your API key<a class="anchor" aria-label="anchor" href="#set-up-your-api-key"></a>
</h2>
<p>You should use an API key to identify yourself when you access
data.census.gov. Like many public APIs, the US Census Bureau’s data
portal allows anonymous users. However, it limits the number of requests
that an anonymous user can send, both per second and per day. If you <a href="http://api.census.gov/data/key_signup.html" class="external-link">register</a> with the
site, it will send you a key. You can use the key to identify yourself
when making future calls. Chances are that you will never come up
against any kind of throttling.</p>
<p>To make it easy for new users, <code>hercacstables</code> includes a
function, <code><a href="../reference/api_key_setup.html">api_key_setup()</a></code>, that will take you to the
sign-up page and then help you permanently save your key as a local
environment variable. That variable is called “CENSUS_API_KEY” to be
compatible with another popular package for accessing the Census API, <a href="https://walker-data.com/tidycensus/index.html" class="external-link">tidycensus</a>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/api_key_setup.html">api_key_setup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ben Taft.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
