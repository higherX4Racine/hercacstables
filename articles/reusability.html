<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Reusability • hercacstables</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reusability">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hercacstables</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/hercacstables.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/set_up_your_api_key.html">Set up your API key</a></li>
    <li><a class="dropdown-item" href="../articles/race_ethnicity_categories.html">Race/Ethnicity Categories in ACS Tables</a></li>
    <li><a class="dropdown-item" href="../articles/reusability.html">Reusability</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/higherX4Racine/hercacstables" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Reusability</h1>
            
      

      <div class="d-none name"><code>reusability.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>A reusable approach incorporates setup and post-processing, which
take place before and after calling for data from the API. Let’s say
that you are interested in the fraction of women who have given birth in
the U.S., broken down by age.</p>
</div>
<div class="section level2">
<h2 id="the-non-reusable-part">The non-reusable part<a class="anchor" aria-label="anchor" href="#the-non-reusable-part"></a>
</h2>
<p>Use <code><a href="../reference/search_in_columns.html">search_in_columns()</a></code> to find tables that are relevant
to our question.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WB_TABLES</span> <span class="op">&lt;-</span> <span class="fu">hercacstables</span><span class="fu">::</span><span class="fu"><a href="../reference/search_in_columns.html">search_in_columns</a></span><span class="op">(</span></span>
<span>    <span class="fu">hercacstables</span><span class="fu">::</span><span class="va"><a href="../reference/METADATA_FOR_ACS_GROUPS.html">METADATA_FOR_ACS_GROUPS</a></span>,</span>
<span>    Group <span class="op">=</span> <span class="st">"\\d$"</span>, <span class="co"># the group must end in a digit, so only "all races" tables</span></span>
<span>    Universe <span class="op">=</span> <span class="st">"wom[ae]n"</span>, <span class="co"># matches woman and women</span></span>
<span>    Description <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"birth"</span>, <span class="st">"year"</span><span class="op">)</span> <span class="co"># the census doesn't use "age" much</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="27%">
<col width="64%">
<col width="2%">
<col width="2%">
</colgroup>
<thead><tr class="header">
<th align="left">Group</th>
<th align="left">Universe</th>
<th align="left">Description</th>
<th align="left">ACS1</th>
<th align="left">ACS5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">B13002</td>
<td align="left">Women 15 to 50 years</td>
<td align="left">Women 15 to 50 Years Who Had a Birth in the Past 12
Months by Marital Status and Age</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">B13004</td>
<td align="left">Women 15 to 50 years in households</td>
<td align="left">Women 15 to 50 Years Who Had a Birth in the Past 12
Months by Presence of Spouse or Unmarried Partner</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">B13008</td>
<td align="left">Women 15 to 50 years</td>
<td align="left">Women 15 to 50 Years Who Had a Birth in the Past 12
Months by Marital Status and Nativity</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">B13010</td>
<td align="left">Women 15 to 50 years for whom poverty status is
determined</td>
<td align="left">Women 15 to 50 Years Who Had a Birth in the Past 12
Months by Marital Status and Poverty Status in the Past 12 Months</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">B13012</td>
<td align="left">Women 16 to 50 years</td>
<td align="left">Women 16 to 50 Years Who Had a Birth in the Past 12
Months by Marital Status and Labor Force Status</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">B13014</td>
<td align="left">Women 15 to 50 years</td>
<td align="left">Women 15 to 50 Years Who Had a Birth in the Past 12
Months by Marital Status and Educational Attainment</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">B13015</td>
<td align="left">Women 15 to 50 years</td>
<td align="left">Women 15 to 50 Years Who Had a Birth in the Past 12
Months by Marital Status and Receipt of Public Assistance Income in the
Past 12 Months</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">B13016</td>
<td align="left">Women 15 to 50 years</td>
<td align="left">Women 15 to 50 Years Who Had a Birth in the Past 12
Months by Age</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
<p>It looks like table <a href="https://api.census.gov/data/2023/acs/acs5/groups/B13016.html" class="external-link">B13016</a>
is exactly what we are looking for.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="section level3">
<h3 id="define-a-glossary-of-variable-meanings">Define a glossary of variable meanings<a class="anchor" aria-label="anchor" href="#define-a-glossary-of-variable-meanings"></a>
</h3>
<p>First, create a glossary table that maps from the Census variables
you need to the real-world meanings that you actually care about.</p>
<p>The following example glosses 12 variables from “B13016.” Each
specific variable encodes four columns’ worth of data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GLOSSARY_OF_WOMEN_AND_BIRTHS</span> <span class="op">&lt;-</span> <span class="st">"B13016"</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">hercacstables</span><span class="fu">::</span><span class="fu"><a href="../reference/unpack_group_details.html">unpack_group_details</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">.data</span><span class="op">$</span><span class="va">Dataset</span> <span class="op">==</span> <span class="st">"ACS1"</span>, <span class="co"># there are details for 1- and 5-year datasets</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">if_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, \<span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="co">#</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        `Gave Birth` <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">A</span>, <span class="st">"had"</span><span class="op">)</span>,</span>
<span>        `Lower Age` <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">B</span>, <span class="st">"^\\d{2}"</span><span class="op">)</span>,</span>
<span>        `Upper Age` <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">B</span>, <span class="st">"(?&lt;!^)\\d{2}"</span><span class="op">)</span>,</span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu">tidyselect</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"Age"</span><span class="op">)</span>,</span>
<span>                      <span class="va">as.integer</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>        <span class="op">!</span><span class="fu">tidyselect</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Dataset</th>
<th align="left">Group</th>
<th align="right">Index</th>
<th align="left">Variable</th>
<th align="left">Gave Birth</th>
<th align="right">Lower Age</th>
<th align="right">Upper Age</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ACS1</td>
<td align="left">B13016</td>
<td align="right">3</td>
<td align="left">B13016_003E</td>
<td align="left">TRUE</td>
<td align="right">15</td>
<td align="right">19</td>
</tr>
<tr class="even">
<td align="left">ACS1</td>
<td align="left">B13016</td>
<td align="right">4</td>
<td align="left">B13016_004E</td>
<td align="left">TRUE</td>
<td align="right">20</td>
<td align="right">24</td>
</tr>
<tr class="odd">
<td align="left">ACS1</td>
<td align="left">B13016</td>
<td align="right">5</td>
<td align="left">B13016_005E</td>
<td align="left">TRUE</td>
<td align="right">25</td>
<td align="right">29</td>
</tr>
<tr class="even">
<td align="left">ACS1</td>
<td align="left">B13016</td>
<td align="right">6</td>
<td align="left">B13016_006E</td>
<td align="left">TRUE</td>
<td align="right">30</td>
<td align="right">34</td>
</tr>
<tr class="odd">
<td align="left">ACS1</td>
<td align="left">B13016</td>
<td align="right">7</td>
<td align="left">B13016_007E</td>
<td align="left">TRUE</td>
<td align="right">35</td>
<td align="right">39</td>
</tr>
<tr class="even">
<td align="left">ACS1</td>
<td align="left">B13016</td>
<td align="right">8</td>
<td align="left">B13016_008E</td>
<td align="left">TRUE</td>
<td align="right">40</td>
<td align="right">44</td>
</tr>
<tr class="odd">
<td align="left">ACS1</td>
<td align="left">B13016</td>
<td align="right">9</td>
<td align="left">B13016_009E</td>
<td align="left">TRUE</td>
<td align="right">45</td>
<td align="right">50</td>
</tr>
<tr class="even">
<td align="left">ACS1</td>
<td align="left">B13016</td>
<td align="right">11</td>
<td align="left">B13016_011E</td>
<td align="left">FALSE</td>
<td align="right">15</td>
<td align="right">19</td>
</tr>
<tr class="odd">
<td align="left">ACS1</td>
<td align="left">B13016</td>
<td align="right">12</td>
<td align="left">B13016_012E</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="left">ACS1</td>
<td align="left">B13016</td>
<td align="right">13</td>
<td align="left">B13016_013E</td>
<td align="left">FALSE</td>
<td align="right">25</td>
<td align="right">29</td>
</tr>
<tr class="odd">
<td align="left">ACS1</td>
<td align="left">B13016</td>
<td align="right">14</td>
<td align="left">B13016_014E</td>
<td align="left">FALSE</td>
<td align="right">30</td>
<td align="right">34</td>
</tr>
<tr class="even">
<td align="left">ACS1</td>
<td align="left">B13016</td>
<td align="right">15</td>
<td align="left">B13016_015E</td>
<td align="left">FALSE</td>
<td align="right">35</td>
<td align="right">39</td>
</tr>
<tr class="odd">
<td align="left">ACS1</td>
<td align="left">B13016</td>
<td align="right">16</td>
<td align="left">B13016_016E</td>
<td align="left">FALSE</td>
<td align="right">40</td>
<td align="right">44</td>
</tr>
<tr class="even">
<td align="left">ACS1</td>
<td align="left">B13016</td>
<td align="right">17</td>
<td align="left">B13016_017E</td>
<td align="left">FALSE</td>
<td align="right">45</td>
<td align="right">50</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="calling-the-api">Calling the API<a class="anchor" aria-label="anchor" href="#calling-the-api"></a>
</h2>
<div class="section level3">
<h3 id="define-a-fetching-function">Define a fetching function<a class="anchor" aria-label="anchor" href="#define-a-fetching-function"></a>
</h3>
<p>Having defined a reusable glossary, we can now define a reusable
fetching function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fetch_women_and_births</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">hercacstables</span><span class="fu">::</span><span class="fu"><a href="../reference/fetch_data.html">fetch_data</a></span><span class="op">(</span></span>
<span>        variables <span class="op">=</span> <span class="va">GLOSSARY_OF_WOMEN_AND_BIRTHS</span><span class="op">$</span><span class="va">Variable</span>,</span>
<span>        survey_type <span class="op">=</span> <span class="st">"acs"</span>,</span>
<span>        table_or_survey_code <span class="op">=</span> <span class="st">"acs1"</span>,</span>
<span>        <span class="va">...</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="send-the-request-to-the-api">Send the request to the API<a class="anchor" aria-label="anchor" href="#send-the-request-to-the-api"></a>
</h3>
<p>Run the <code><a href="../reference/fetch_data.html">fetch_data()</a></code> command by itself so that you can
cache it. In this example, we will ask for the most recent data for the
whole country.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RAW_WOMEN_AND_BIRTHS</span> <span class="op">&lt;-</span> <span class="fu">fetch_women_and_births</span><span class="op">(</span></span>
<span>    year <span class="op">=</span> <span class="fu">hercacstables</span><span class="fu">::</span><span class="fu"><a href="../reference/most_recent_vintage.html">most_recent_vintage</a></span><span class="op">(</span><span class="st">"acs"</span>, <span class="st">"acs1"</span><span class="op">)</span>,</span>
<span>    for_geo <span class="op">=</span> <span class="st">"us"</span>,</span>
<span>    for_items <span class="op">=</span> <span class="st">"*"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">us</th>
<th align="left">Group</th>
<th align="right">Index</th>
<th align="right">Value</th>
<th align="right">Year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">B13016</td>
<td align="right">3</td>
<td align="right">91,622</td>
<td align="right">2023</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">B13016</td>
<td align="right">4</td>
<td align="right">548,375</td>
<td align="right">2023</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">B13016</td>
<td align="right">5</td>
<td align="right">989,964</td>
<td align="right">2023</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">B13016</td>
<td align="right">6</td>
<td align="right">1,201,077</td>
<td align="right">2023</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">B13016</td>
<td align="right">7</td>
<td align="right">792,711</td>
<td align="right">2023</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">B13016</td>
<td align="right">8</td>
<td align="right">269,902</td>
<td align="right">2023</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">B13016</td>
<td align="right">9</td>
<td align="right">125,282</td>
<td align="right">2023</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">B13016</td>
<td align="right">11</td>
<td align="right">10,712,296</td>
<td align="right">2023</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">B13016</td>
<td align="right">12</td>
<td align="right">9,996,049</td>
<td align="right">2023</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">B13016</td>
<td align="right">13</td>
<td align="right">9,825,750</td>
<td align="right">2023</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">B13016</td>
<td align="right">14</td>
<td align="right">10,392,627</td>
<td align="right">2023</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">B13016</td>
<td align="right">15</td>
<td align="right">10,419,909</td>
<td align="right">2023</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">B13016</td>
<td align="right">16</td>
<td align="right">10,755,886</td>
<td align="right">2023</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">B13016</td>
<td align="right">17</td>
<td align="right">11,862,580</td>
<td align="right">2023</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="postprocessing">Postprocessing<a class="anchor" aria-label="anchor" href="#postprocessing"></a>
</h2>
<div class="section level3">
<h3 id="wrangle-the-result-into-a-helpful-format">Wrangle the result into a helpful format<a class="anchor" aria-label="anchor" href="#wrangle-the-result-into-a-helpful-format"></a>
</h3>
<p>The raw data do not answer our question all by themselves. We are
interested in rates, not counts. Using the
<code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">dplyr::summarize()</a></code> function will let us get rid of the
superfluous information about marital status.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wrangle_women_and_births</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.raw_api_output</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">.raw_api_output</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>            <span class="va">GLOSSARY_OF_WOMEN_AND_BIRTHS</span>,</span>
<span>            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Group"</span>, <span class="st">"Index"</span><span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>            `Recent Mothers` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">Value</span> <span class="op">*</span> <span class="va">.data</span><span class="op">$</span><span class="va">`Gave Birth`</span><span class="op">)</span>,</span>
<span>            `All Women` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">Value</span><span class="op">)</span>,</span>
<span>            Rate <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">`Recent Mothers`</span> <span class="op">/</span> <span class="va">.data</span><span class="op">$</span><span class="va">`All Women`</span>,</span>
<span>            .by <span class="op">=</span> <span class="fu">tidyselect</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">...</span>, <span class="st">"Lower Age"</span>, <span class="st">"Upper Age"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">WOMEN_AND_BIRTHS</span> <span class="op">&lt;-</span> <span class="fu">wrangle_women_and_births</span><span class="op">(</span><span class="va">RAW_WOMEN_AND_BIRTHS</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Lower Age</th>
<th align="right">Upper Age</th>
<th align="right">Recent Mothers</th>
<th align="right">All Women</th>
<th align="right">Rate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">15</td>
<td align="right">19</td>
<td align="right">91,622</td>
<td align="right">10,803,918</td>
<td align="right">1%</td>
</tr>
<tr class="even">
<td align="right">20</td>
<td align="right">24</td>
<td align="right">548,375</td>
<td align="right">10,544,424</td>
<td align="right">5%</td>
</tr>
<tr class="odd">
<td align="right">25</td>
<td align="right">29</td>
<td align="right">989,964</td>
<td align="right">10,815,714</td>
<td align="right">9%</td>
</tr>
<tr class="even">
<td align="right">30</td>
<td align="right">34</td>
<td align="right">1,201,077</td>
<td align="right">11,593,704</td>
<td align="right">10%</td>
</tr>
<tr class="odd">
<td align="right">35</td>
<td align="right">39</td>
<td align="right">792,711</td>
<td align="right">11,212,620</td>
<td align="right">7%</td>
</tr>
<tr class="even">
<td align="right">40</td>
<td align="right">44</td>
<td align="right">269,902</td>
<td align="right">11,025,788</td>
<td align="right">2%</td>
</tr>
<tr class="odd">
<td align="right">45</td>
<td align="right">50</td>
<td align="right">125,282</td>
<td align="right">11,987,862</td>
<td align="right">1%</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="reusability">Reusability<a class="anchor" aria-label="anchor" href="#reusability"></a>
</h2>
<p>The benefit of this approach is that we can reuse the fetching and
wrangling functions.</p>
<div class="section level3">
<h3 id="across-places">Across Places<a class="anchor" aria-label="anchor" href="#across-places"></a>
</h3>
<p>In this example, we pull data for three different counties in
Wisconsin.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SE_WI_WOMEN_AND_BIRTHS</span> <span class="op">&lt;-</span> <span class="fu">fetch_women_and_births</span><span class="op">(</span></span>
<span>    state <span class="op">=</span> <span class="fl">55</span>,</span>
<span>    for_geo <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>    for_items <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"059"</span>, <span class="st">"079"</span>, <span class="st">"101"</span><span class="op">)</span>, <span class="co"># Kenosha, Racine, and Milwaukee</span></span>
<span>    year <span class="op">=</span> <span class="fl">2023</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">wrangle_women_and_births</span><span class="op">(</span></span>
<span>        <span class="st">"county"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        county <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">county</span>,</span>
<span>                                  <span class="st">"059"</span> <span class="op">~</span> <span class="st">"Kenosha"</span>,</span>
<span>                                  <span class="st">"079"</span> <span class="op">~</span> <span class="st">"Milwaukee"</span>,</span>
<span>                                  <span class="st">"101"</span> <span class="op">~</span> <span class="st">"Racine"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p>For a simpler table, we’ll exclude the counts of mothers and women,
then pivot the rate data by county.</p>
<table class="table">
<thead><tr class="header">
<th align="right">Lower Age</th>
<th align="right">Upper Age</th>
<th align="right">Kenosha</th>
<th align="right">Milwaukee</th>
<th align="right">Racine</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">15</td>
<td align="right">19</td>
<td align="right">0%</td>
<td align="right">1%</td>
<td align="right">0%</td>
</tr>
<tr class="even">
<td align="right">20</td>
<td align="right">24</td>
<td align="right">1%</td>
<td align="right">4%</td>
<td align="right">2%</td>
</tr>
<tr class="odd">
<td align="right">25</td>
<td align="right">29</td>
<td align="right">16%</td>
<td align="right">6%</td>
<td align="right">18%</td>
</tr>
<tr class="even">
<td align="right">30</td>
<td align="right">34</td>
<td align="right">5%</td>
<td align="right">9%</td>
<td align="right">17%</td>
</tr>
<tr class="odd">
<td align="right">35</td>
<td align="right">39</td>
<td align="right">2%</td>
<td align="right">8%</td>
<td align="right">10%</td>
</tr>
<tr class="even">
<td align="right">40</td>
<td align="right">44</td>
<td align="right">3%</td>
<td align="right">1%</td>
<td align="right">1%</td>
</tr>
<tr class="odd">
<td align="right">45</td>
<td align="right">50</td>
<td align="right">0%</td>
<td align="right">1%</td>
<td align="right">0%</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="through-time">Through time<a class="anchor" aria-label="anchor" href="#through-time"></a>
</h3>
<p>In this example, we pull data about Texas from three years. We have
to make three separate calls, one for each year. It’s an idiosyncrasy of
this particular API.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TEXAS_WOMEN_AND_BIRTHS</span> <span class="op">&lt;-</span> <span class="fl">2021</span><span class="op">:</span><span class="fl">2023</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>        \<span class="op">(</span><span class="va">.y</span><span class="op">)</span> <span class="fu">fetch_women_and_births</span><span class="op">(</span></span>
<span>            for_geo <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>            for_items <span class="op">=</span> <span class="fl">48L</span>,</span>
<span>            year <span class="op">=</span> <span class="va">.y</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">wrangle_women_and_births</span><span class="op">(</span></span>
<span>        <span class="st">"Year"</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p>For a simpler table, we’ll exclude the counts of mothers and women,
then pivot the rate data by year.</p>
<table class="table">
<thead><tr class="header">
<th align="right">Lower Age</th>
<th align="right">Upper Age</th>
<th align="right">2021</th>
<th align="right">2022</th>
<th align="right">2023</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">15</td>
<td align="right">19</td>
<td align="right">2%</td>
<td align="right">1%</td>
<td align="right">1%</td>
</tr>
<tr class="even">
<td align="right">20</td>
<td align="right">24</td>
<td align="right">8%</td>
<td align="right">7%</td>
<td align="right">7%</td>
</tr>
<tr class="odd">
<td align="right">25</td>
<td align="right">29</td>
<td align="right">11%</td>
<td align="right">11%</td>
<td align="right">10%</td>
</tr>
<tr class="even">
<td align="right">30</td>
<td align="right">34</td>
<td align="right">11%</td>
<td align="right">11%</td>
<td align="right">10%</td>
</tr>
<tr class="odd">
<td align="right">35</td>
<td align="right">39</td>
<td align="right">7%</td>
<td align="right">6%</td>
<td align="right">7%</td>
</tr>
<tr class="even">
<td align="right">40</td>
<td align="right">44</td>
<td align="right">2%</td>
<td align="right">3%</td>
<td align="right">2%</td>
</tr>
<tr class="odd">
<td align="right">45</td>
<td align="right">50</td>
<td align="right">1%</td>
<td align="right">1%</td>
<td align="right">1%</td>
</tr>
</tbody>
</table>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Higher Expectations for Racine County, Ben Taft.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
