<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Work with American Community Survey Tables through the US Census API • hercacstables</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Work with American Community Survey Tables through the US Census API">
<meta name="description" content="The American Community Survey (ACS) from the US Census's website returns data in a weirdly idiosyncratic way. There are many subtotals in each table. Grouping variables are organized in a tree-like, rather than tabular fashion. This package is intended to make it easy to access and use the ACS data with R.">
<meta property="og:description" content="The American Community Survey (ACS) from the US Census's website returns data in a weirdly idiosyncratic way. There are many subtotals in each table. Grouping variables are organized in a tree-like, rather than tabular fashion. This package is intended to make it easy to access and use the ACS data with R.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">hercacstables</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/hercacstables.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/average_tract_poverty_ratio.html">Average Poverty Ratios by Tract in Racine County, WI</a></li>
    <li><a class="dropdown-item" href="articles/children_in_poverty.html">Children in Poverty</a></li>
    <li><a class="dropdown-item" href="articles/race_ethnicity_categories.html">Race/Ethnicity Categories in ACS Tables</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="hercacstables">hercacstables<a class="anchor" aria-label="anchor" href="#hercacstables"></a>
</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"higherX4Racine/hercacstables"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>The American Community Survey (ACS) from the US Census’s website returns data in a weirdly idiosyncratic way. There are many subtotals in each table. Grouping variables are organized in a tree-like, rather than tabular fashion. This package is intended to make it easy to access and use the ACS data with R.</p>
<p>Many questions that work with Census data follow a common pattern:</p>
<blockquote>
<p>How did [measurement] differ among [demographic groups] and across [geographic levels] in [geographic area] during [span of time]?</p>
</blockquote>
<p>A <strong>Measurement</strong> is any of the huge number of things that the Census keeps track of. Measurements are arranged in tables (called “groups”) and rows. If you were drawing maps, this would be what determines the color of each area. Examples include population size (table B01001 and others), median household income (table B19013 and others), types of computers in a household (table B28001), number of vehicles used while commuting (table B08015).</p>
<p>A <strong>Demographic Group</strong> is a subset of the population that shares specific traits. Demographic groups can be represented either by groups (common when reporting by race or ethnicity) or rows (most other cases, like age, sex, or veteran status). If you were drawing maps, you would probably have a different version of each map for each demographic grouping. Examples include the number of Hispanic girls under 5 years old (table B01001I, row 18), the median income of Asian American households (table B19013D, row 1), the number of households with no computer (table B28001, row 11), the number of vehicles used by women while commuting (table B08015, row 3).</p>
<p>A <strong>Geographic Level</strong> is a <a href="https://www.census.gov/programs-surveys/geography/guidance.html" class="external-link">Census-defined hierarchy</a> from the whole country to small blocks. The level that you are interested in is determined by the scale of your question. If you were drawing maps, these would be the areas that appeared as different colors. Examples include congressional districts, incorporated cities, school districts, and Census tracts.</p>
<p>A <strong>Geographic Area</strong> is a set of specific instances of one or more geographic levels. This is the full geographic scope of your question. If you were drawing maps, this would determine their scale. Examples include whole states, metropolitan areas, Census-designated places, and counties.</p>
</div>
<div class="section level2">
<h2 id="the-workflow">The workflow<a class="anchor" aria-label="anchor" href="#the-workflow"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Identify the groups and rows that contain the data you need
<ul>
<li>Use <code><a href="reference/METADATA_ACS5.html">hercacstables::METADATA_ACS5</a></code> for this!</li>
<li>Create a lookup table that maps from the Census variable name to your variables.
<ul>
<li>You may need several if you are pulling data from several groups.</li>
</ul>
</li>
</ul>
</li>
<li>Define the geographies that you will use
<ul>
<li>Use <code><a href="reference/METADATA_ACS5.html">hercacstables::METADATA_ACS5</a></code> for this, too!</li>
<li>You need to know at least two levels of geography:
<ul>
<li>The one that you want to pull data for, your level of interest
<ul>
<li>This is often small, like tract or county subdivision.</li>
</ul>
</li>
<li>Any and all levels that contain your level of interest
<ul>
<li>These will be larger, like state or county.</li>
</ul>
</li>
</ul>
</li>
<li>Create a lookup table that maps from geographic ids to meaningful names.</li>
</ul>
</li>
<li>Write fetching functions that call <code><a href="reference/fetch_data.html">hercacstables::fetch_data</a></code>
<ul>
<li>they will often always use the same variables (from step 1)</li>
<li>they may need to be parameterized by geography if you’re pulling from multiple levels</li>
<li>they should always be parameterized by year so that you can reuse them</li>
</ul>
</li>
<li>Write wrangling functions that for turning fetched tables into useful ones.
<ul>
<li>These will probably involve using <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">dplyr::inner_join</a></code> between the fetched data and your lookup tables.</li>
<li>You can also perform calculations like aggregating or finding remainders.</li>
</ul>
</li>
<li>Run the workflow in two stages.
<ul>
<li>Use <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map</a></code> and <code><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">purrr::list_rbind</a></code> to download all of the data into one data frame.
<ul>
<li>Cache that result because API calls are slow</li>
</ul>
</li>
<li>Run the wrangling functions.
<ul>
<li>Save these results with, e.g. <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">base::saveRDS</a></code>.</li>
</ul>
</li>
</ul>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Let’s say you want to ask this question:</p>
<blockquote>
<p>How did [the number of households] differ between [Hispanic and non-Hispanic people] and across [Manchester, Nashua, and suburban areas] in [Hillsborough County, NH] during [the last 10 years]?</p>
</blockquote>
<div class="section level3">
<h3 id="find-the-measurement-and-demographic-groups">find the <strong>measurement</strong> and <strong>demographic groups</strong>
<a class="anchor" aria-label="anchor" href="#find-the-measurement-and-demographic-groups"></a>
</h3>
<p>First, find the variables that describe the numbers of households. One way to do this is to search <code><a href="reference/METADATA_ACS5.html">hercacstables::METADATA_ACS5</a></code> for groups whose “Universe” is “Households” and whose “Description” contains “Hispanic” or “Ethnicity.” A group’s “Universe” describes what it is measuring, often telling you the units of whatever its values are. A group’s “Description” is a phrase that summarizes what it reports.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">hercacstables</span><span class="fu">::</span><span class="va"><a href="reference/METADATA_ACS5.html">METADATA_ACS5</a></span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="st">"groups"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">Universe</span>, <span class="st">"Household"</span><span class="op">)</span>,</span>
<span>                  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">Description</span>, <span class="st">"Hispanic|Ethnic"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="64%">
<col width="31%">
</colgroup>
<thead><tr class="header">
<th align="left">Group</th>
<th align="left">Description</th>
<th align="left">Universe</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">B11001H</td>
<td align="left">Household Type (Including Living Alone) (White Alone, Not Hispanic or Latino)</td>
<td align="left">Households with a householder who is White alone, not Hispanic or Latino</td>
</tr>
<tr class="even">
<td align="left">B11001I</td>
<td align="left">Household Type (Including Living Alone) (Hispanic or Latino)</td>
<td align="left">Households with a householder who is Hispanic or Latino</td>
</tr>
<tr class="odd">
<td align="left">B19001H</td>
<td align="left">Household Income in the Past 12 Months (in 2022 Inflation-Adjusted Dollars) (White Alone, Not Hispanic or Latino Householder)</td>
<td align="left">Households with a householder who is White alone, not Hispanic or Latino</td>
</tr>
<tr class="even">
<td align="left">B19001I</td>
<td align="left">Household Income in the Past 12 Months (in 2022 Inflation-Adjusted Dollars) (Hispanic or Latino Householder)</td>
<td align="left">Households with a householder who is Hispanic or Latino</td>
</tr>
<tr class="odd">
<td align="left">B19013H</td>
<td align="left">Median Household Income in the Past 12 Months (in 2022 Inflation-Adjusted Dollars) (White Alone, Not Hispanic or Latino Householder)</td>
<td align="left">Households with a householder who is White alone, not Hispanic or Latino</td>
</tr>
<tr class="even">
<td align="left">B19013I</td>
<td align="left">Median Household Income in the Past 12 Months (in 2022 Inflation-Adjusted Dollars) (Hispanic or Latino Householder)</td>
<td align="left">Households with a householder who is Hispanic or Latino</td>
</tr>
<tr class="odd">
<td align="left">B19025H</td>
<td align="left">Aggregate Household Income in the Past 12 Months (in 2022 Inflation-Adjusted Dollars) (White Alone, Not Hispanic or Latino Householder)</td>
<td align="left">Households with a householder who is White alone, not Hispanic or Latino</td>
</tr>
<tr class="even">
<td align="left">B19025I</td>
<td align="left">Aggregate Household Income in the Past 12 Months (in 2022 Inflation-Adjusted Dollars) (Hispanic or Latino Householder)</td>
<td align="left">Households with a householder who is Hispanic or Latino</td>
</tr>
<tr class="odd">
<td align="left">B19037H</td>
<td align="left">Age of Householder by Household Income in the Past 12 Months (in 2022 Inflation-Adjusted Dollars) (White Alone, Not Hispanic or Latino Householder)</td>
<td align="left">Households with a householder who is White alone, not Hispanic or Latino</td>
</tr>
<tr class="even">
<td align="left">B19037I</td>
<td align="left">Age of Householder by Household Income in the Past 12 Months (in 2022 Inflation-Adjusted Dollars) (Hispanic or Latino Householder)</td>
<td align="left">Households with a householder who is Hispanic or Latino</td>
</tr>
<tr class="odd">
<td align="left">B22005H</td>
<td align="left">Receipt of Food Stamps/SNAP in the Past 12 Months by Race of Householder (White Alone, Not Hispanic or Latino)</td>
<td align="left">Households with a householder who is White alone, not Hispanic or Latino</td>
</tr>
<tr class="even">
<td align="left">B22005I</td>
<td align="left">Receipt of Food Stamps/SNAP in the Past 12 Months by Race of Householder (Hispanic or Latino)</td>
<td align="left">Households with a householder who is Hispanic or Latino</td>
</tr>
</tbody>
</table>
<p>It looks like our best bet is group “B11001I.” It is likely that group “B11001” contains counts of households of any race. The first row of most groups is the total value across any demographic subset that it keeps track of. Since our question does not ask about different household types, we probably just need row one from groups “B11001” and “B11001I.” This gives us a good opportunity to document the ethnicities counted in each.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HOUSEHOLD_GROUPS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B11001"</span>, <span class="st">"B11001I"</span><span class="op">)</span></span>
<span><span class="va">household_variables</span> <span class="op">&lt;-</span> <span class="fu">hercacstables</span><span class="fu">::</span><span class="va"><a href="reference/METADATA_ACS5.html">METADATA_ACS5</a></span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="st">"variables"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">Group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">HOUSEHOLD_GROUPS</span>,</span>
<span>                  <span class="va">.data</span><span class="op">$</span><span class="va">Index</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        Ethnicity <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">Group</span>,</span>
<span>                                      <span class="st">"B11001"</span> <span class="op">~</span> <span class="st">"All"</span>,</span>
<span>                                      <span class="st">"B11001I"</span> <span class="op">~</span> <span class="st">"Hispanic or Latino"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"Group"</span>, <span class="st">"Index"</span>, <span class="st">"Variable"</span>, <span class="st">"Ethnicity"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">household_variables</span>,</span>
<span>             align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lrll"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Group</th>
<th align="right">Index</th>
<th align="left">Variable</th>
<th align="left">Ethnicity</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">B11001I</td>
<td align="right">1</td>
<td align="left">B11001I_001E</td>
<td align="left">Hispanic or Latino</td>
</tr>
<tr class="even">
<td align="left">B11001</td>
<td align="right">1</td>
<td align="left">B11001_001E</td>
<td align="left">All</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="find-the-geographic-levels-and-geographic-area">find the <strong>geographic levels</strong> and <strong>geographic area</strong>
<a class="anchor" aria-label="anchor" href="#find-the-geographic-levels-and-geographic-area"></a>
</h3>
<p>The next step is to <a href="https://www.census.gov/library/reference/code-lists/ansi.html" class="external-link">find the codes</a> that are related to the geographic areas and levels. We need to know the FIPS code for the state, county, and two cities. We also need to know that the geographic level that we’re working with is “county subdivision.” As the last part of this step, we define a lookup table to translate from the FIPS codes for the different geographies to a human-readable name.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NEW_HAMPSHIRE</span> <span class="op">&lt;-</span> <span class="st">"33"</span></span>
<span><span class="va">COUNTY_LEVEL</span> <span class="op">&lt;-</span> <span class="st">"county"</span></span>
<span><span class="va">HILLSBOROUGH_CO</span> <span class="op">&lt;-</span> <span class="st">"011"</span></span>
<span><span class="va">CITY_LEVEL</span> <span class="op">&lt;-</span> <span class="st">"county subdivision"</span></span>
<span><span class="va">MANCHESTER_NH</span> <span class="op">&lt;-</span> <span class="st">"45140"</span></span>
<span><span class="va">NASHUA_NH</span> <span class="op">&lt;-</span> <span class="st">"50260"</span></span>
<span></span>
<span><span class="va">geography_definitions</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>    <span class="op">~</span> <span class="va">FIPS</span>,          <span class="op">~</span> <span class="va">Location</span>,</span>
<span>    <span class="va">HILLSBOROUGH_CO</span>, <span class="st">"County-wide"</span>,</span>
<span>    <span class="va">MANCHESTER_NH</span>,   <span class="st">"Manchester"</span>,</span>
<span>    <span class="va">NASHUA_NH</span>,       <span class="st">"Nashua"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">geography_definitions</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">FIPS</th>
<th align="left">Location</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">011</td>
<td align="left">County-wide</td>
</tr>
<tr class="even">
<td align="left">45140</td>
<td align="left">Manchester</td>
</tr>
<tr class="odd">
<td align="left">50260</td>
<td align="left">Nashua</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="find-the-time-interval">find the <strong>time interval</strong>
<a class="anchor" aria-label="anchor" href="#find-the-time-interval"></a>
</h3>
<p>The last ten years available from the Census are, as of 2024-09-13, 2012 through 2022. We can use 1-year estimates for our question because we are dealing with geographic levels that have more than 50,000 people in them. That gives us more year-to-year precision, although it does mean that we have to exclude 2020. There are no 1-year ACS estimates for 2020 because of the COVID-19 pandemic.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">YEARS_INCLUDED</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2012</span><span class="op">:</span><span class="fl">2019</span>, <span class="fl">2021</span><span class="op">:</span><span class="fl">2022</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="define-functions-that-use-the-api">define functions that use the API<a class="anchor" aria-label="anchor" href="#define-functions-that-use-the-api"></a>
</h3>
<p>We will need to make multiple calls to the API, so it makes sense to create some reusable functions. We need two calls per year. The first one will pull the county-wide household counts. The second one will pull the household counts for each city. Each function should have “year” as its argument so that we can reuse it.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">generalized_fetch_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.year</span>, <span class="va">.level</span>, <span class="va">.areas</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">hercacstables</span><span class="fu">::</span><span class="fu"><a href="reference/fetch_data.html">fetch_data</a></span><span class="op">(</span></span>
<span>        variables <span class="op">=</span> <span class="va">household_variables</span><span class="op">$</span><span class="va">Variable</span>,</span>
<span>        year <span class="op">=</span> <span class="va">.year</span>,</span>
<span>        survey_type <span class="op">=</span> <span class="st">"acs"</span>,</span>
<span>        table_or_survey_code <span class="op">=</span> <span class="st">"acs1"</span>,</span>
<span>        for_geo <span class="op">=</span> <span class="va">.level</span>,</span>
<span>        for_items <span class="op">=</span> <span class="va">.areas</span>,</span>
<span>        state <span class="op">=</span> <span class="va">NEW_HAMPSHIRE</span>,</span>
<span>        <span class="va">...</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fetch_county_households</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.year</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">generalized_fetch_data</span><span class="op">(</span><span class="va">.year</span>,</span>
<span>                           <span class="st">"county"</span>,</span>
<span>                           <span class="va">HILLSBOROUGH_CO</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fetch_city_households</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.year</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">generalized_fetch_data</span><span class="op">(</span><span class="va">.year</span>,</span>
<span>                           <span class="va">CITY_LEVEL</span>,</span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">MANCHESTER_NH</span>,</span>
<span>                             <span class="va">NASHUA_NH</span><span class="op">)</span>,</span>
<span>                           county <span class="op">=</span> <span class="va">HILLSBOROUGH_CO</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fetch_example_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.year</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>        <span class="fu">fetch_county_households</span><span class="op">(</span><span class="va">.year</span><span class="op">)</span>,</span>
<span>        <span class="fu">fetch_city_households</span><span class="op">(</span><span class="va">.year</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fetch-the-data">fetch the data<a class="anchor" aria-label="anchor" href="#fetch-the-data"></a>
</h3>
<p>This is where <code>hercacstables</code> starts to come into its own. We define the fetching process as few times as possible, just tweaking it for related cases. This leads to a lot of code reuse and efficiency, especially for reports that you just need to update once a year.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raw_households</span> <span class="op">&lt;-</span> <span class="va">YEARS_INCLUDED</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">fetch_example_data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raw_households</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">2022</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Value"</span><span class="op">)</span>,</span>
<span>                      <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_comma</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>        align <span class="op">=</span> <span class="st">"lllrrrl"</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="10%">
<col width="12%">
<col width="13%">
<col width="10%">
<col width="13%">
<col width="9%">
<col width="30%">
</colgroup>
<thead><tr class="header">
<th align="left">state</th>
<th align="left">county</th>
<th align="left">Group</th>
<th align="right">Index</th>
<th align="right">Value</th>
<th align="right">Year</th>
<th align="left">county subdivision</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">33</td>
<td align="left">011</td>
<td align="left">B11001I</td>
<td align="right">1</td>
<td align="right">10,250</td>
<td align="right">2022</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">33</td>
<td align="left">011</td>
<td align="left">B11001</td>
<td align="right">1</td>
<td align="right">167,816</td>
<td align="right">2022</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">33</td>
<td align="left">011</td>
<td align="left">B11001I</td>
<td align="right">1</td>
<td align="right">4,251</td>
<td align="right">2022</td>
<td align="left">45140</td>
</tr>
<tr class="even">
<td align="left">33</td>
<td align="left">011</td>
<td align="left">B11001</td>
<td align="right">1</td>
<td align="right">48,068</td>
<td align="right">2022</td>
<td align="left">45140</td>
</tr>
<tr class="odd">
<td align="left">33</td>
<td align="left">011</td>
<td align="left">B11001I</td>
<td align="right">1</td>
<td align="right">4,155</td>
<td align="right">2022</td>
<td align="left">50260</td>
</tr>
<tr class="even">
<td align="left">33</td>
<td align="left">011</td>
<td align="left">B11001</td>
<td align="right">1</td>
<td align="right">38,017</td>
<td align="right">2022</td>
<td align="left">50260</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="wrangle-the-data">wrangle the data<a class="anchor" aria-label="anchor" href="#wrangle-the-data"></a>
</h3>
<p>The raw data are not very usable. Several of the columns still have codes, rather than human-readable values. The value column also does not explicitly state values for the suburban or for non-Hispanic folks. The “wrangling” process is where we addressing these drawbacks.</p>
<div class="section level4">
<h4 id="map-codes-to-words">map codes to words<a class="anchor" aria-label="anchor" href="#map-codes-to-words"></a>
</h4>
<p>We should get rid of the columns that are Census database codes and create columns about location and demographics that have human-readable values.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">households</span> <span class="op">&lt;-</span> <span class="va">raw_households</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>        <span class="va">household_variables</span>,</span>
<span>        by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Group"</span>, <span class="st">"Index"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        FIPS <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html" class="external-link">coalesce</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">`county subdivision`</span>,</span>
<span>                               <span class="va">.data</span><span class="op">$</span><span class="va">county</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>        <span class="va">geography_definitions</span>,</span>
<span>        by <span class="op">=</span> <span class="st">"FIPS"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>        <span class="st">"Location"</span>,</span>
<span>        <span class="st">"Year"</span>,</span>
<span>        <span class="st">"Ethnicity"</span>,</span>
<span>        Households <span class="op">=</span> <span class="st">"Value"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">households</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">2022</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Households"</span><span class="op">)</span>,</span>
<span>                      <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_comma</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>        align <span class="op">=</span> <span class="st">"rllr"</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Location</th>
<th align="left">Year</th>
<th align="left">Ethnicity</th>
<th align="right">Households</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">County-wide</td>
<td align="left">2022</td>
<td align="left">Hispanic or Latino</td>
<td align="right">10,250</td>
</tr>
<tr class="even">
<td align="right">County-wide</td>
<td align="left">2022</td>
<td align="left">All</td>
<td align="right">167,816</td>
</tr>
<tr class="odd">
<td align="right">Manchester</td>
<td align="left">2022</td>
<td align="left">Hispanic or Latino</td>
<td align="right">4,251</td>
</tr>
<tr class="even">
<td align="right">Manchester</td>
<td align="left">2022</td>
<td align="left">All</td>
<td align="right">48,068</td>
</tr>
<tr class="odd">
<td align="right">Nashua</td>
<td align="left">2022</td>
<td align="left">Hispanic or Latino</td>
<td align="right">4,155</td>
</tr>
<tr class="even">
<td align="right">Nashua</td>
<td align="left">2022</td>
<td align="left">All</td>
<td align="right">38,017</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="compute-implicit-values">compute implicit values<a class="anchor" aria-label="anchor" href="#compute-implicit-values"></a>
</h4>
<p>Now that the columns are human-readable, we can compute the values that we are actually interested in. That computation involves subtracting either the cities’ households from the county’s, or the number of Hispanic households from the total number of households. This task turns up very frequently when dealing with Census data, so the package includes a helper function to do it for you: <code><a href="reference/subtract_parts_from_whole.html">hercacstables::subtract_parts_from_whole</a></code>. That function does not remove the rows that contain the all-groups category. In our case, we must remove them so all of the calculations come out correctly.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">households</span> <span class="op">&lt;-</span> <span class="va">households</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">hercacstables</span><span class="fu">::</span><span class="fu"><a href="reference/subtract_parts_from_whole.html">subtract_parts_from_whole</a></span><span class="op">(</span></span>
<span>        grouping_column <span class="op">=</span> <span class="st">"Location"</span>,</span>
<span>        value_column <span class="op">=</span> <span class="st">"Households"</span>,</span>
<span>        whole_name <span class="op">=</span> <span class="st">"County-wide"</span>,</span>
<span>        part_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Manchester"</span>, <span class="st">"Nashua"</span><span class="op">)</span>,</span>
<span>        remainder_name <span class="op">=</span> <span class="st">"Suburbs"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>        <span class="op">!</span><span class="st">"County-wide"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">hercacstables</span><span class="fu">::</span><span class="fu"><a href="reference/subtract_parts_from_whole.html">subtract_parts_from_whole</a></span><span class="op">(</span></span>
<span>        grouping_column <span class="op">=</span> <span class="st">"Ethnicity"</span>,</span>
<span>        value_column <span class="op">=</span> <span class="st">"Households"</span>,</span>
<span>        whole_name <span class="op">=</span> <span class="st">"All"</span>,</span>
<span>        part_names <span class="op">=</span> <span class="st">"Hispanic or Latino"</span>,</span>
<span>        remainder_name <span class="op">=</span> <span class="st">"Not Hispanic or Latino"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>        <span class="op">!</span><span class="st">"All"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">households</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">2022</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Households"</span><span class="op">)</span>,</span>
<span>                      <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_comma</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>        align <span class="op">=</span> <span class="st">"rllr"</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Year</th>
<th align="left">Location</th>
<th align="left">Ethnicity</th>
<th align="right">Households</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">2022</td>
<td align="left">Manchester</td>
<td align="left">Hispanic or Latino</td>
<td align="right">4,251</td>
</tr>
<tr class="even">
<td align="right">2022</td>
<td align="left">Manchester</td>
<td align="left">Not Hispanic or Latino</td>
<td align="right">43,817</td>
</tr>
<tr class="odd">
<td align="right">2022</td>
<td align="left">Nashua</td>
<td align="left">Hispanic or Latino</td>
<td align="right">4,155</td>
</tr>
<tr class="even">
<td align="right">2022</td>
<td align="left">Nashua</td>
<td align="left">Not Hispanic or Latino</td>
<td align="right">33,862</td>
</tr>
<tr class="odd">
<td align="right">2022</td>
<td align="left">Suburbs</td>
<td align="left">Hispanic or Latino</td>
<td align="right">1,844</td>
</tr>
<tr class="even">
<td align="right">2022</td>
<td align="left">Suburbs</td>
<td align="left">Not Hispanic or Latino</td>
<td align="right">79,887</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="answer-the-question">Answer the question<a class="anchor" aria-label="anchor" href="#answer-the-question"></a>
</h3>
<p>Now we can finally look at trends in number of households in Hillsborough County, NH, comparing between Hispanic and non-Hispanic households among Manchester, Nashua, and the suburbs.</p>
<div class="section level4">
<h4 id="visualize">visualize<a class="anchor" aria-label="anchor" href="#visualize"></a>
</h4>
<p>The first step is to make some graphs. These data are 4-dimensional because they involve time, location, ethnicity, and number of households. That means we’ll need more than one graph. It looked from the tables above that the number of Hispanic households is much lower than non-Hispanic households in all three locations. Let’s make a two-panel graph, where each panel shows one ethnicity. That way they can have separate y axes. Both graphs will have time on the x-axis, number of households on the y, and designate location with the color of points and lines.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">households</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>            x <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">Year</span>,</span>
<span>            y <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">Households</span>,</span>
<span>            color <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">Location</span>,</span>
<span>            group <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">Location</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>        linewidth <span class="op">=</span> <span class="fl">2</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>        size <span class="op">=</span> <span class="fl">5</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_width.html" class="external-link">breaks_width</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>        minor_breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_width.html" class="external-link">breaks_width</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="st">"Number of households"</span>,</span>
<span>        limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>        labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_comma</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        guide <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span></span>
<span>        rows <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">Ethnicity</span><span class="op">)</span>,</span>
<span>        scales <span class="op">=</span> <span class="st">"free_y"</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot-the-results-1.png" width="100%"></p>
<p>It looks like the number of households is growing, with non-Hispanic households increasing in the suburbs and Hispanic households increasing in the cities.</p>
</div>
<div class="section level4">
<h4 id="analyze">analyze<a class="anchor" aria-label="anchor" href="#analyze"></a>
</h4>
<p>Let’s test this with an ANCOVA. We’ll subtract 2012 from the year so that the intercept estimate gives us the value in 2012, not AD 0.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">household_model</span> <span class="op">&lt;-</span> <span class="va">households</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        Year <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">Year</span> <span class="op">-</span> <span class="fl">2012</span>,</span>
<span>        Location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">Location</span>,</span>
<span>                          levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Suburbs"</span>,</span>
<span>                                     <span class="st">"Manchester"</span>,</span>
<span>                                     <span class="st">"Nashua"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        Ethnicity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">Ethnicity</span>,</span>
<span>                           levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Not Hispanic or Latino"</span>,</span>
<span>                                      <span class="st">"Hispanic or Latino"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Households</span> <span class="op">~</span> <span class="va">Year</span> <span class="op">*</span> <span class="va">Ethnicity</span> <span class="op">*</span> <span class="va">Location</span>,</span>
<span>       data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span></code></pre></div>
<p>I always like to look at the ANOVA table first to get a 10,000 meter view before I try to interpret specific parameters.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">household_model</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sumsq"</span>,</span>
<span>                        <span class="st">"meansq"</span><span class="op">)</span>,</span>
<span>                      <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_comma</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="st">"statistic"</span>,</span>
<span>                      \<span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">signif</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="st">"p.value"</span>,</span>
<span>                      \<span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>        align <span class="op">=</span> <span class="st">"lrrrrr"</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="30%">
<col width="6%">
<col width="19%">
<col width="19%">
<col width="13%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left">term</th>
<th align="right">df</th>
<th align="right">sumsq</th>
<th align="right">meansq</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Year</td>
<td align="right">1</td>
<td align="right">42,871,954</td>
<td align="right">42,871,954</td>
<td align="right">83.890</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">Ethnicity</td>
<td align="right">1</td>
<td align="right">32,103,588,465</td>
<td align="right">32,103,588,465</td>
<td align="right">62820.000</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">Location</td>
<td align="right">2</td>
<td align="right">4,375,353,354</td>
<td align="right">2,187,676,677</td>
<td align="right">4281.000</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">Year:Ethnicity</td>
<td align="right">1</td>
<td align="right">13,470,367</td>
<td align="right">13,470,367</td>
<td align="right">26.360</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">Year:Location</td>
<td align="right">2</td>
<td align="right">4,035,620</td>
<td align="right">2,017,810</td>
<td align="right">3.948</td>
<td align="right">0.0265</td>
</tr>
<tr class="even">
<td align="left">Ethnicity:Location</td>
<td align="right">2</td>
<td align="right">5,270,922,505</td>
<td align="right">2,635,461,253</td>
<td align="right">5157.000</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">Year:Ethnicity:Location</td>
<td align="right">2</td>
<td align="right">7,717,340</td>
<td align="right">3,858,670</td>
<td align="right">7.551</td>
<td align="right">0.0015</td>
</tr>
<tr class="even">
<td align="left">Residuals</td>
<td align="right">44</td>
<td align="right">22,485,689</td>
<td align="right">511,038</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p>It looks like EVERYTHING is significant, so let’s look at all of the parameters that were in the near-significant range.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">household_model</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">.data</span><span class="op">$</span><span class="va">`p.value`</span> <span class="op">&lt;</span> <span class="fl">0.1</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimate"</span>,</span>
<span>                        <span class="st">"std.error"</span>,</span>
<span>                        <span class="st">"statistic"</span><span class="op">)</span>,</span>
<span>                      \<span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">signif</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="st">"p.value"</span>,</span>
<span>                      \<span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>        align <span class="op">=</span> <span class="st">"lrrrr"</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="56%">
<col width="10%">
<col width="11%">
<col width="11%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">73790.0</td>
<td align="right">442.30</td>
<td align="right">166.800</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">Year</td>
<td align="right">632.6</td>
<td align="right">74.53</td>
<td align="right">8.488</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">EthnicityHispanic or Latino</td>
<td align="right">-72830.0</td>
<td align="right">625.50</td>
<td align="right">-116.400</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">LocationManchester</td>
<td align="right">-32160.0</td>
<td align="right">599.60</td>
<td align="right">-53.630</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">LocationNashua</td>
<td align="right">-41770.0</td>
<td align="right">625.50</td>
<td align="right">-66.770</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">Year:EthnicityHispanic or Latino</td>
<td align="right">-550.1</td>
<td align="right">105.40</td>
<td align="right">-5.219</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">Year:LocationManchester</td>
<td align="right">-449.6</td>
<td align="right">103.20</td>
<td align="right">-4.355</td>
<td align="right">0.0001</td>
</tr>
<tr class="even">
<td align="left">Year:LocationNashua</td>
<td align="right">-402.7</td>
<td align="right">105.40</td>
<td align="right">-3.821</td>
<td align="right">0.0004</td>
</tr>
<tr class="odd">
<td align="left">EthnicityHispanic or Latino:LocationManchester</td>
<td align="right">33920.0</td>
<td align="right">848.00</td>
<td align="right">40.000</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">EthnicityHispanic or Latino:LocationNashua</td>
<td align="right">43220.0</td>
<td align="right">884.60</td>
<td align="right">48.850</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">Year:EthnicityHispanic or Latino:LocationManchester</td>
<td align="right">521.9</td>
<td align="right">146.00</td>
<td align="right">3.575</td>
<td align="right">0.0009</td>
</tr>
<tr class="even">
<td align="left">Year:EthnicityHispanic or Latino:LocationNashua</td>
<td align="right">467.4</td>
<td align="right">149.10</td>
<td align="right">3.135</td>
<td align="right">0.0031</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="summarize">summarize<a class="anchor" aria-label="anchor" href="#summarize"></a>
</h4>
<p>The number of households in Hillsborough county overall grew from 2012-2022. The number of Hispanic households was much higher in the two cities than in the suburban parts of the county. This difference became more pronounced over the decade, for two reasons. The number of Hispanic households grew more quickly in Nashua and Manchester than in the suburban areas. The number of non-Hispanic households grew more quickly in the suburbs than in the cities. Isn’t it nice when the visual patterns are corroborated by significant statistics?</p>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing hercacstables</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Ben Taft <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ben Taft.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
